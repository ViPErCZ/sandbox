tinymce.PluginManager.add('macros', function (editor, url) {

	var dialog = function () {
		// Open window
		editor.windowManager.open({
			width: 800,
			height: 130,
			resizable: false,
			title: 'Unsubscribe makro',
			body: [
				{type: 'textbox', name: 'text', label: 'Text odkazu', width: 125},
				{type: 'textbox', name: 'css', label: 'Css styl', width: 125}
			],
			onsubmit: function (e) {
				// Insert content when the window form is submitted
				if (e.data.text == "" && e.data.css == "") {
					editor.insertContent("[~unsubscribe~]"); // + e.data.title);
				} else if (e.data.text != "" && e.data.css == "") {
					editor.insertContent("[~unsubscribe text='" + e.data.text + "'~]");
				} else if (e.data.text == "" && e.data.css != "") {
					editor.windowManager.alert("Prosím vyplňte položku 'Text odkazu'.");
					return false;
				} else if (e.data.text != "" && e.data.css != "") {
					editor.insertContent("[~unsubscribe text='" + e.data.text + "', style='" + e.data.css + "'~]");
				}
			}
		});
	}

	// Add a button that opens a window
	editor.addButton('macros', {
		type: 'listbox',
		text: 'Vložit makro',
		icon: false,
		onselect: function (e) {
			editor.insertContent(this.value());
		},
		values: [
			{
				text: 'Unsubscribe', onclick: function () {
				// Open window
				dialog();
			}
			},
		],
		onPostRender: function () {
			// Select the second item by default
			this.value('');
		}
	});

	editor.addMenuItem("cell", {
		separator: "before",
		text: "Vložit makro",
		context: "tools",
		menu: [{
			text: "Unsubscribe", onclick: function () {
				// Open window
				dialog();
			}
		}]
	});
});